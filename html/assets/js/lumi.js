var CryptoJS=CryptoJS||function(f,l){var g={},h=g.lib={},p=h.Base=function(){function a(){}return{extend:function(b){a.prototype=this;var c=new a;b&&c.mixIn(b);c.hasOwnProperty("init")||(c.init=function(){c.$super.init.apply(this,arguments)});c.init.prototype=c;c.$super=this;return c},create:function(){var a=this.extend();a.init.apply(a,arguments);return a},init:function(){},mixIn:function(a){for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b]);a.hasOwnProperty("toString")&&(this.toString=a.toString)},
clone:function(){return this.init.prototype.extend(this)}}}(),k=h.WordArray=p.extend({init:function(a,b){a=this.words=a||[];this.sigBytes=b!=l?b:4*a.length},toString:function(a){return(a||r).stringify(this)},concat:function(a){var b=this.words,c=a.words,e=this.sigBytes;a=a.sigBytes;this.clamp();if(e%4)for(var d=0;d<a;d++)b[e+d>>>2]|=(c[d>>>2]>>>24-d%4*8&255)<<24-(e+d)%4*8;else if(65535<c.length)for(d=0;d<a;d+=4)b[e+d>>>2]=c[d>>>2];else b.push.apply(b,c);this.sigBytes+=a;return this},clamp:function(){var a=
this.words,b=this.sigBytes;a[b>>>2]&=4294967295<<32-b%4*8;a.length=f.ceil(b/4)},clone:function(){var a=p.clone.call(this);a.words=this.words.slice(0);return a},random:function(a){for(var b=[],c=0;c<a;c+=4)b.push(4294967296*f.random()|0);return new k.init(b,a)}}),q=g.enc={},r=q.Hex={stringify:function(a){var b=a.words;a=a.sigBytes;for(var c=[],d=0;d<a;d++){var e=b[d>>>2]>>>24-d%4*8&255;c.push((e>>>4).toString(16));c.push((e&15).toString(16))}return c.join("")},parse:function(a){for(var b=a.length,
c=[],d=0;d<b;d+=2)c[d>>>3]|=parseInt(a.substr(d,2),16)<<24-d%8*4;return new k.init(c,b/2)}},a=q.Latin1={stringify:function(a){var b=a.words;a=a.sigBytes;for(var c=[],d=0;d<a;d++)c.push(String.fromCharCode(b[d>>>2]>>>24-d%4*8&255));return c.join("")},parse:function(a){for(var b=a.length,c=[],d=0;d<b;d++)c[d>>>2]|=(a.charCodeAt(d)&255)<<24-d%4*8;return new k.init(c,b)}},c=q.Utf8={stringify:function(b){try{return decodeURIComponent(escape(a.stringify(b)))}catch(c){throw Error("Malformed UTF-8 data");
}},parse:function(b){return a.parse(unescape(encodeURIComponent(b)))}};q.Base64={stringify:function(a){var b=a.words,c=a.sigBytes,d=this._map;a.clamp();a=[];for(var e=0;e<c;e+=3)for(var f=(b[e>>>2]>>>24-e%4*8&255)<<16|(b[e+1>>>2]>>>24-(e+1)%4*8&255)<<8|b[e+2>>>2]>>>24-(e+2)%4*8&255,m=0;4>m&&e+.75*m<c;m++)a.push(d.charAt(f>>>6*(3-m)&63));if(b=d.charAt(64))for(;a.length%4;)a.push(b);return a.join("")},parse:function(a){var b=a.length,c=this._map,d=c.charAt(64);d&&(d=a.indexOf(d),-1!=d&&(b=d));for(var d=
[],e=0,f=0;f<b;f++)if(f%4){var m=c.indexOf(a.charAt(f-1))<<f%4*2,g=c.indexOf(a.charAt(f))>>>6-f%4*2;d[e>>>2]|=(m|g)<<24-e%4*8;e++}return k.create(d,e)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="};var b=h.BufferedBlockAlgorithm=p.extend({reset:function(){this._data=new k.init;this._nDataBytes=0},_append:function(a){"string"==typeof a&&(a=c.parse(a));this._data.concat(a);this._nDataBytes+=a.sigBytes},_process:function(a){var b=this._data,c=b.words,d=b.sigBytes,e=this.blockSize,
m=d/(4*e),m=a?f.ceil(m):f.max((m|0)-this._minBufferSize,0);a=m*e;d=f.min(4*a,d);if(a){for(var g=0;g<a;g+=e)this._doProcessBlock(c,g);g=c.splice(0,a);b.sigBytes-=d}return new k.init(g,d)},clone:function(){var a=p.clone.call(this);a._data=this._data.clone();return a},_minBufferSize:0}),e=h.Hasher=b.extend({cfg:p.extend(),init:function(a){this.cfg=this.cfg.extend(a);this.reset()},reset:function(){b.reset.call(this);this._doReset()},update:function(a){this._append(a);this._process();return this},finalize:function(a){a&&
this._append(a);return this._doFinalize()},blockSize:16,_createHelper:function(a){return function(b,c){return(new a.init(c)).finalize(b)}},_createHmacHelper:function(a){return function(b,c){return(new d.HMAC.init(a,c)).finalize(b)}}}),d=g.algo={},m=[],h=d.SHA1=e.extend({_doReset:function(){this._hash=new k.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(a,b){for(var c=this._hash.words,d=c[0],e=c[1],f=c[2],g=c[3],l=c[4],h=0;80>h;h++){if(16>h)m[h]=a[b+h]|0;else{var k=
m[h-3]^m[h-8]^m[h-14]^m[h-16];m[h]=k<<1|k>>>31}k=(d<<5|d>>>27)+l+m[h];k=20>h?k+((e&f|~e&g)+1518500249):40>h?k+((e^f^g)+1859775393):60>h?k+((e&f|e&g|f&g)-1894007588):k+((e^f^g)-899497514);l=g;g=f;f=e<<30|e>>>2;e=d;d=k}c[0]=c[0]+d|0;c[1]=c[1]+e|0;c[2]=c[2]+f|0;c[3]=c[3]+g|0;c[4]=c[4]+l|0},_doFinalize:function(){var a=this._data,b=a.words,c=8*this._nDataBytes,d=8*a.sigBytes;b[d>>>5]|=128<<24-d%32;b[(d+64>>>9<<4)+14]=f.floor(c/4294967296);b[(d+64>>>9<<4)+15]=c;a.sigBytes=4*b.length;this._process();return this._hash},
clone:function(){var a=e.clone.call(this);a._hash=this._hash.clone();return a}});g.SHA1=e._createHelper(h);g.HmacSHA1=e._createHmacHelper(h);return g}(Math);Date.prototype.toISOString||function(){function f(f){f=String(f);1===f.length&&(f="0"+f);return f}Date.prototype.toISOString=function(){return this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"."+String((this.getUTCMilliseconds()/1E3).toFixed(3)).slice(2,5)+"Z"}}();
function toBase64(f){return CryptoJS&&CryptoJS.enc.Base64?CryptoJS.enc.Base64.stringify(CryptoJS.enc.Latin1.parse(f)):Base64.encode(f)}function toSHA1(f){return CryptoJS&&CryptoJS.SHA1?CryptoJS.SHA1(f).toString():Crypto.util.bytesToHex(Crypto.SHA1(f,{asBytes:!0}))}
function isDate(f){f="[object Date]"===Object.prototype.toString.call(f)?f:new Date(f);if("[object Date]"===Object.prototype.toString.call(f))return isNaN(f.valueOf())?(ADL.XAPIWrapper.log("Invalid date String passed"),null):f;ADL.XAPIWrapper.log("Invalid date object");return null}
(function(f){function l(){try{return void 0!=this.lrs.endpoint&&""!=this.lrs.endpoint}catch(a){return!1}}function g(a){if(!g.debug)return!1;try{return console.log(a),!0}catch(c){return!1}}function h(a,c){for(var b in c){prop=c[b];g(b+" : "+prop);try{c[b].constructor==Object?a[b]=h(a[b],c[b]):(void 0==a&&(a={}),a[b]=c[b])}catch(e){void 0==a&&(a={}),a[b]=c[b]}}return a}function p(a){var c="endpoint auth actor registration activity_id grouping activity_platform".split(" "),b={},e,d,f,g;d=window.location.href.split("?");
if(2===d.length)for(e=d[1],d=e.split("&"),e={},g=0;g<d.length;g++)f=d[g].split("="),2===f.length&&f[0]&&(e[f[0]]=decodeURIComponent(f[1]));if(void 0!==e&&0!==Object.keys(e).length){for(f=0;f<c.length;f++)d=c[f],e[d]&&(b[d]=e[d],delete e[d]);0!==Object.keys(e).length&&(b.extended=e);b=h(a,b)}else b=a;return b}function k(){var a=new XMLHttpRequest,c=window.location+"?forcenocache="+f.ruuid();a.open("GET",c,!1);a.send(null)}function q(a,c,b,e){var d=[],f=c.indexOf("?");0<f&&(d.push(c.substr(f+1)),c=
c.substr(0,f));c=c+"?method="+a;if(null!==b)for(var g in b)d.push(g+"="+encodeURIComponent(b[g]));null!==e&&d.push("content="+encodeURIComponent(e));return{method:"POST",url:c,headers:{},data:d.join("&")}}g.debug=!1;var r=function(){var a={endpoint:"http://localhost:8000/xapi/"};try{a.auth="Basic "+toBase64("tom:1234")}catch(c){g("Exception in Config trying to encode auth: "+c)}return a}();XAPIWrapper=function(a,c){function b(a){var b=document.createElement("a");b.href=a;if(b.protocol&&b.host)return b.protocol+
"//"+b.host;f.XAPIWrapper.log("Couldn't create base url from endpoint: "+this.lrs.endpoint)}function e(a,b,c){a.auth="Basic "+toBase64(b+":"+c)}this.lrs=p(a||{});this.lrs.user&&this.lrs.password&&e(this.lrs,this.lrs.user,this.lrs.password);this.base=b(this.lrs.endpoint);c&&l.call(this)&&window.ADL.XHR_request(this.lrs,this.lrs.endpoint+"about","GET",null,null,function(a){if(200==a.status)try{var b=JSON.parse(a.response);a=!1;for(var c in b.version)if(b.version[c]==f.XAPIWrapper.xapiVersion){a=!0;
break}a||f.XAPIWrapper.log("The lrs version ["+b.version+"] does not match this wrapper's XAPI version ["+f.XAPIWrapper.xapiVersion+"]")}catch(e){f.XAPIWrapper.log("The response was not an about object")}else f.XAPIWrapper.log("The request to get information about the LRS failed: "+a)});this.searchParams=function(){return{format:"exact"}};this.hash=function(a){if(!a)return null;try{return toSHA1(a)}catch(b){return f.XAPIWrapper.log("Error trying to hash -- "+b),null}};this.changeConfig=function(a){try{f.XAPIWrapper.log("updating lrs object with new configuration"),
this.lrs=h(this.lrs,a),a.user&&a.password&&this.updateAuth(this.lrs,a.user,a.password),this.base=b(this.lrs.endpoint)}catch(c){f.XAPIWrapper.log("error while changing configuration -- "+c)}};this.updateAuth=e};XAPIWrapper.prototype.xapiVersion="1.0.1";XAPIWrapper.prototype.prepareStatement=function(a){void 0===a.actor?a.actor=JSON.parse(this.lrs.actor):"string"===typeof a.actor&&(a.actor=JSON.parse(a.actor));(this.lrs.grouping||this.lrs.registration||this.lrs.activity_platform)&&!a.context&&(a.context=
{});this.lrs.grouping&&(a.context.contextActivities||(a.context.contextActivities={}),a.context.contextActivities.grouping=[{id:this.lrs.grouping}]);this.lrs.registration&&(a.context.registration=this.lrs.registration);this.lrs.activity_platform&&(a.context.platform=this.lrs.activity_platform)};XAPIWrapper.prototype.testConfig=l;XAPIWrapper.prototype.log=g;XAPIWrapper.prototype.sendStatement=function(a,c){if(this.testConfig()){this.prepareStatement(a);var b;a.id?b=a.id:(b=f.ruuid(),a.id=b);var e=
f.XHR_request(this.lrs,this.lrs.endpoint+"statements","POST",JSON.stringify(a),this.lrs.auth,c,{id:b});if(!c)return{xhr:e,id:b}}};XAPIWrapper.prototype.sendStatements=function(a,c){if(this.testConfig()){for(var b in a)this.prepareStatement(a[b]);b=f.XHR_request(this.lrs,this.lrs.endpoint+"statements","POST",JSON.stringify(a),this.lrs.auth,c);if(!c)return b}};XAPIWrapper.prototype.getStatements=function(a,c,b){if(this.testConfig()){var e=this.lrs.endpoint+"statements";if(c)e=this.base+c;else{c=[];
for(s in a)"until"==s||"since"==s?c.push(s+"="+encodeURIComponent((new Date(a[s])).toISOString())):c.push(s+"="+encodeURIComponent(a[s]));0<c.length&&(e=e+"?"+c.join("&"))}a=f.XHR_request(this.lrs,e,"GET",null,this.lrs.auth,b);if(void 0===a||404==a.status)return null;try{return JSON.parse(a.response)}catch(d){return a.response}}};XAPIWrapper.prototype.getActivities=function(a,c){if(this.testConfig()){var b=this.lrs.endpoint+"activities?activityId=<activityid>",b=b.replace("<activityid>",encodeURIComponent(a)),
b=f.XHR_request(this.lrs,b,"GET",null,this.lrs.auth,c,null,!0);if(void 0===b||404==b.status)return null;try{return JSON.parse(b.response)}catch(e){return b.response}}};XAPIWrapper.prototype.sendState=function(a,c,b,e,d,m,h,l){if(this.testConfig()){var k=this.lrs.endpoint+"activities/state?activityId=<activity ID>&agent=<agent>&stateId=<stateid>",k=k.replace("<activity ID>",encodeURIComponent(a)),k=k.replace("<agent>",encodeURIComponent(JSON.stringify(c))),k=k.replace("<stateid>",encodeURIComponent(b));
e&&(k+="&registration="+encodeURIComponent(e));a=null;m&&h?g("Can't have both If-Match and If-None-Match"):m?a={"If-Match":'"'+m+'"'}:h&&(a={"If-None-Match":'"'+h+'"'});m="PUT";if(d)d instanceof Array?(d=JSON.stringify(d),a=a||{},a["Content-Type"]="application/json"):d instanceof Object?(d=JSON.stringify(d),a=a||{},a["Content-Type"]="application/json",m="POST"):(a=a||{},a["Content-Type"]="application/octet-stream");else return this.log("No activity state was included."),!1;f.XHR_request(this.lrs,
k,m,d,this.lrs.auth,l,null,null,a)}};XAPIWrapper.prototype.getState=function(a,c,b,e,d,g){if(this.testConfig()){var h=this.lrs.endpoint+"activities/state?activityId=<activity ID>&agent=<agent>",h=h.replace("<activity ID>",encodeURIComponent(a)),h=h.replace("<agent>",encodeURIComponent(JSON.stringify(c)));b&&(h+="&stateId="+encodeURIComponent(b));e&&(h+="&registration="+encodeURIComponent(e));d&&(d=isDate(d),null!=d&&(h+="&since="+encodeURIComponent(d.toISOString())));a=f.XHR_request(this.lrs,h,"GET",
null,this.lrs.auth,g,null,!0);if(void 0===a||404==a.status)return null;try{return JSON.parse(a.response)}catch(l){return a.response}}};XAPIWrapper.prototype.deleteState=function(a,c,b,e,d,h,l){if(this.testConfig()){var k=this.lrs.endpoint+"activities/state?activityId=<activity ID>&agent=<agent>&stateId=<stateid>",k=k.replace("<activity ID>",encodeURIComponent(a)),k=k.replace("<agent>",encodeURIComponent(JSON.stringify(c))),k=k.replace("<stateid>",encodeURIComponent(b));e&&(k+="&registration="+encodeURIComponent(e));
a=null;d&&h?g("Can't have both If-Match and If-None-Match"):d?a={"If-Match":'"'+d+'"'}:h&&(a={"If-None-Match":'"'+h+'"'});d=f.XHR_request(this.lrs,k,"DELETE",null,this.lrs.auth,l,null,a);if(void 0===d||404==d.status)return null;try{return JSON.parse(d.response)}catch(q){return d}}};XAPIWrapper.prototype.sendActivityProfile=function(a,c,b,e,d,h){if(this.testConfig()){var k=this.lrs.endpoint+"activities/profile?activityId=<activity ID>&profileId=<profileid>",k=k.replace("<activity ID>",encodeURIComponent(a)),
k=k.replace("<profileid>",encodeURIComponent(c));a=null;e&&d?g("Can't have both If-Match and If-None-Match"):e?a={"If-Match":'"'+e+'"'}:d&&(a={"If-None-Match":'"'+d+'"'});e="PUT";if(b)b instanceof Array?(b=JSON.stringify(b),a=a||{},a["Content-Type"]="application/json"):b instanceof Object?(b=JSON.stringify(b),a=a||{},a["Content-Type"]="application/json",e="POST"):(a=a||{},a["Content-Type"]="application/octet-stream");else return this.log("No activity profile was included."),!1;f.XHR_request(this.lrs,
k,e,b,this.lrs.auth,h,null,!1,a)}};XAPIWrapper.prototype.getActivityProfile=function(a,c,b,e){if(this.testConfig()){var d=this.lrs.endpoint+"activities/profile?activityId=<activity ID>",d=d.replace("<activity ID>",encodeURIComponent(a));c&&(d+="&profileId="+encodeURIComponent(c));b&&(b=isDate(b),null!=b&&(d+="&since="+encodeURIComponent(b.toISOString())));a=f.XHR_request(this.lrs,d,"GET",null,this.lrs.auth,e,null,!0);if(void 0===a||404==a.status)return null;try{return JSON.parse(a.response)}catch(g){return a.response}}};
XAPIWrapper.prototype.deleteActivityProfile=function(a,c,b,e,d){if(this.testConfig()){var h=this.lrs.endpoint+"activities/profile?activityId=<activity ID>&profileId=<profileid>",h=h.replace("<activity ID>",encodeURIComponent(a)),h=h.replace("<profileid>",encodeURIComponent(c));a=null;b&&e?g("Can't have both If-Match and If-None-Match"):b?a={"If-Match":'"'+b+'"'}:e&&(a={"If-None-Match":'"'+e+'"'});b=f.XHR_request(this.lrs,h,"DELETE",null,this.lrs.auth,d,null,a);if(void 0===b||404==b.status)return null;
try{return JSON.parse(b.response)}catch(k){return b}}};XAPIWrapper.prototype.getAgents=function(a,c){if(this.testConfig()){var b=this.lrs.endpoint+"agents?agent=<agent>",b=b.replace("<agent>",encodeURIComponent(JSON.stringify(a))),b=f.XHR_request(this.lrs,b,"GET",null,this.lrs.auth,c,null,!0);if(void 0===b||404==b.status)return null;try{return JSON.parse(b.response)}catch(e){return b.response}}};XAPIWrapper.prototype.sendAgentProfile=function(a,c,b,e,d,h){if(this.testConfig()){var k=this.lrs.endpoint+
"agents/profile?agent=<agent>&profileId=<profileid>",k=k.replace("<agent>",encodeURIComponent(JSON.stringify(a))),k=k.replace("<profileid>",encodeURIComponent(c));a=null;e&&d?g("Can't have both If-Match and If-None-Match"):e?a={"If-Match":'"'+e+'"'}:d&&(a={"If-None-Match":'"'+d+'"'});e="PUT";if(b)b instanceof Array?(b=JSON.stringify(b),a=a||{},a["Content-Type"]="application/json"):b instanceof Object?(b=JSON.stringify(b),a=a||{},a["Content-Type"]="application/json",e="POST"):(a=a||{},a["Content-Type"]=
"application/octet-stream");else return this.log("No agent profile was included."),!1;f.XHR_request(this.lrs,k,e,b,this.lrs.auth,h,null,!1,a)}};XAPIWrapper.prototype.getAgentProfile=function(a,c,b,e){if(this.testConfig()){var d=this.lrs.endpoint+"agents/profile?agent=<agent>",d=d.replace("<agent>",encodeURIComponent(JSON.stringify(a))),d=d.replace("<profileid>",encodeURIComponent(c));c&&(d+="&profileId="+encodeURIComponent(c));b&&(b=isDate(b),null!=b&&(d+="&since="+encodeURIComponent(b.toISOString())));
a=f.XHR_request(this.lrs,d,"GET",null,this.lrs.auth,e,null,!0);if(void 0===a||404==a.status)return null;try{return JSON.parse(a.response)}catch(g){return a.response}}};XAPIWrapper.prototype.deleteAgentProfile=function(a,c,b,e,d){if(this.testConfig()){var h=this.lrs.endpoint+"agents/profile?agent=<agent>&profileId=<profileid>",h=h.replace("<agent>",encodeURIComponent(JSON.stringify(a))),h=h.replace("<profileid>",encodeURIComponent(c));a=null;b&&e?g("Can't have both If-Match and If-None-Match"):b?a=
{"If-Match":'"'+b+'"'}:e&&(a={"If-None-Match":'"'+e+'"'});b=f.XHR_request(this.lrs,h,"DELETE",null,this.lrs.auth,d,null,a);if(void 0===b||404==b.status)return null;try{return JSON.parse(b.response)}catch(k){return b}}};f.ruuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var c=16*Math.random()|0;return("x"==a?c:c&3|8).toString(16)})};f.dateFromISOString=function(a){a=a.match(/([0-9]{4})(-([0-9]{2})(-([0-9]{2})([T| ]([0-9]{2}):([0-9]{2})(:([0-9]{2})(.([0-9]+))?)?(Z|(([-+])([0-9]{2}):([0-9]{2})))?)?)?)?/);
var c=0,b=new Date(a[1],0,1);a[3]&&b.setMonth(a[3]-1);a[5]&&b.setDate(a[5]);a[7]&&b.setHours(a[7]);a[8]&&b.setMinutes(a[8]);a[10]&&b.setSeconds(a[10]);a[12]&&b.setMilliseconds(1E3*Number("0."+a[12]));a[14]&&(c=60*Number(a[16])+Number(a[17]),c*="-"==a[15]?1:-1);c-=b.getTimezoneOffset();time=Number(b)+6E4*c;a=new Date;a.setTime(Number(time));return a};f.XHR_request=function(a,c,b,e,d,g,h,l,p){function r(){if(y)return A;y=!0;var a=l&&404===n.status;if(void 0===n.status||200<=n.status&&400>n.status||
a)if(g)if(h)g(n,h);else try{var d=JSON.parse(n.responseText);g(n,d)}catch(e){g(n,n.responseText)}else return A=n;else{var k;try{k="There was a problem communicating with the Learning Record Store. ( "+n.status+" | "+n.response+" )"+c}catch(p){k=p.toString()}f.XAPIWrapper.log(k);f.xhrRequestOnError(n,b,c,g,h);return A=n}}var n,y=!1,w=!1;a=!1;var x,u=c.toLowerCase().match(/^(.+):\/\/([^:\/]*):?(\d+)?(\/.*)?$/),z=window.location,A,t={"Content-Type":"application/json"};t.Authorization=d;t["X-Experience-API-Version"]=
f.XAPIWrapper.xapiVersion;if(null!==p)for(var v in p)t[v]=p[v];w=z.protocol.toLowerCase()!==u[1]||z.hostname.toLowerCase()!==u[2];w||(d=null===u[3]?"http"===u[1]?"80":"443":u[3],w=d===z.port);if(w&&"undefined"!==typeof XDomainRequest)a=!0,x=q(b,c,t,e),n=new XDomainRequest,n.open(x.method,x.url);else for(v in n=new XMLHttpRequest,n.open(b,c,null!=g),t)n.setRequestHeader(v,t[v]);n.onreadystatechange=function(){if(4===n.readyState)return r()};n.onload=r;n.onerror=r;n.send(a?x.data:e);if(!g){if(a)for(e=
1E3+new Date;new Date<e&&4!==n.readyState&&!y;)k();return r()}};f.xhrRequestOnError=function(a,c,b,e,d){};f.XAPIWrapper=new XAPIWrapper(r,!1)})(window.ADL=window.ADL||{});(function(f){function l(a,b){var e=b.split("."),d=e[0];b=e.slice(1).join(".");a[d]||(/\[\]$/.test(d)?(d=d.slice(0,-2),a[d]=[]):a[d]={});return b?l(a[d],b):a[d]}var g=function(c,b,e){if(c&&c.actor&&c.verb&&c.object){e=c;for(var d in e)"actor"!=d&&"verb"!=d&&"object"!=d&&(this[d]=e[d]);c=e.actor;b=e.verb;e=e.object}c?c instanceof h?this.actor=c:"Agent"!==c.objectType&&c.objectType?"Group"===c.objectType&&(this.actor=new p(c)):this.actor=new h(c):this.actor=null;this.verb=b?b instanceof k?b:new k(b):
null;this.object=e?"Activity"!==e.objectType&&e.objectType?"Agent"===e.objectType?e instanceof h?e:new h(e):"Group"===e.objectType?e instanceof p?e:new p(e):"StatementRef"===e.objectType?e instanceof r?e:new r(e):"SubStatement"===e.objectType?e instanceof a?e:new a(e):null:e instanceof q?e:new q(e):null;this.generateId=function(){this.id=f.ruuid()}};g.prototype.toString=function(){return this.actor.toString()+" "+this.verb.toString()+" "+this.object.toString()};g.prototype.isValid=function(){return this.actor&&
this.actor.isValid()&&this.verb&&this.verb.isValid()&&this.object&&this.object.isValid()};g.prototype.generateRegistration=function(){l(this,"context").registration=f.ruuid()};g.prototype.addParentActivity=function(a){l(this,"context.contextActivities.parent[]").push(new q(a))};g.prototype.addGroupingActivity=function(a){l(this,"context.contextActivities.grouping[]").push(new q(a))};g.prototype.addOtherContextActivity=function(a){l(this,"context.contextActivities.other[]").push(new q(a))};var h=function(a,
b){this.objectType="Agent";this.name=b;if(a&&(a.mbox||a.mbox_sha1sum||a.openid||a.account))for(var e in a)this[e]=a[e];else/^mailto:/.test(a)?this.mbox=a:/^[0-9a-f]{40}$/i.test(a)?this.mbox_sha1sum=a:/^http[s]?:/.test(a)?this.openid=a:a&&a.homePage&&a.name&&(this.account=a)};h.prototype.toString=function(){return this.name||this.mbox||this.openid||this.mbox_sha1sum||this.account.name};h.prototype.isValid=function(){return this.mbox||this.mbox_sha1sum||this.openid||this.account.homePage&&this.account.name||
"Group"===this.objectType&&this.member};var p=function(a,b,e){h.call(this,a,e);this.member=b;this.objectType="Group"};p.prototype=new h;var k=function(a,b){if(a&&a.id)for(var e in a)this[e]=a[e];else this.id=a,b&&(this.display="string"===typeof b||b instanceof String?{"en-US":b}:b)};k.prototype.toString=function(){return this.display&&(this.display["en-US"]||this.display.en)?this.display["en-US"]||this.display.en:this.id};k.prototype.isValid=function(){return this.id};var q=function(a,b,e){if(a&&
a.id)for(var d in a)this[d]=a[d];else if(this.objectType="Activity",this.id=a,b||e)this.definition={},"string"===typeof b||b instanceof String?this.definition.name={"en-US":b}:b&&(this.definition.name=b),"string"===typeof e||e instanceof String?this.definition.description={"en-US":e}:e&&(this.definition.description=e)};q.prototype.toString=function(){return this.definition&&this.definition.name&&(this.definition.name["en-US"]||this.definition.name.en)?this.definition.name["en-US"]||this.definition.name.en:
this.id};q.prototype.isValid=function(){return this.id&&(!this.objectType||"Activity"===this.objectType)};var r=function(a){if(a&&a.id)for(var b in a)this[b]=a[b];else this.objectType="StatementRef",this.id=a};r.prototype.toString=function(){return"statement("+this.id+")"};r.prototype.isValid=function(){return this.id&&this.objectType&&"StatementRef"===this.objectType};var a=function(a,b,e){g.call(this,a,b,e);this.objectType="SubStatement";delete this.id;delete this.stored;delete this.version;delete this.authority};
a.prototype=new g;a.prototype.toString=function(){return'"'+a.prototype.prototype.toString.call(this)+'"'};g.Agent=h;g.Group=p;g.Verb=k;g.Activity=q;g.StatementRef=r;g.SubStatement=a;f.XAPIStatement=g})(window.ADL=window.ADL||{});var LumiX=function(){this.openLocker=function(f,l,g){"undefined"===window.ADL&&this.log("~~> XAPI API MISSING! <~~~");l.length&&g.length&&(this.course_id_uuid=l,this.course_uri=g,this.breadcrumb(ADL.XAPIWrapper.hash(g)),$.ajax({url:this.locker_store+f,success:function(f){Lumi.endpoint=f.uri.toString();Lumi.user=f.username.toString();Lumi.password=f.password.toString();Lumi.change_config();Lumi.log("L:"+Lumi.endpoint);Lumi.log("u:"+Lumi.user);Lumi.log("p:"+Lumi.password);Lumi.initialized=!0;Lumi.log("Initialized.")}}))};
this.setLocker=function(f,l,g){this.log("WARNING: Method deprecated; use openLocker");return this.NOERROR_DEPRECATED};this.setLearner=function(f,l){var g=this.ERROR.INVALID_PARAM;f.toString().length&&l.toString().length?(this.student.named=f,this.student.inbox="mailto:"+l,this.actor=JSON.stringify({mbox:this.student.inbox,name:this.student.named}),g=this.ERROR.NOERROR):this.log("WARNING: Name and email required!");return g};this.cue=function(f,l,g){f=new ADL.XAPIStatement(this.user,f,this.course_uri+
this.course_id_uuid+"/");f.actor=this.actor;f.object={id:this.course_uri+this.course_id_uuid+"/JSQbd/",definition:{name:{"en-US":l.toString()},description:{"en-US":l.toString()}},objectType:"Activity"};if(g.hasOwnProperty("exarg")){l=f.object.definition;var h;l.type="http://adlnet.gov/expapi/activities/cmi.interaction";l.interactionType="performance";l.steps=[];for(h in g.exarg)l.steps.push({id:h,description:{"en-US":g.exarg[h]}})}return this.send_statement(f)};this.addVerb=function(f){this.VERB[f.toUpperCase()]=
{id:"http://learningconsole.com/verbs/"+f.toLowerCase(),display:{"en-US":f.toLowerCase()}}};this.addVerbEx=function(f,l){var g=this.ERROR.NOERROR;l.hasOwnProperty("id")?l.hasOwnProperty("display")?this.VERB[f]=l:g=this.ERROR.INVALID_PARAM:g=this.ERROR.INVALID_PARAM;return g};this.jot=function(f){var l=this.ERROR.INVALID_PARAM;f.hasOwnProperty("verb")&&this.VERB.hasOwnProperty(f.verb.toString().toUpperCase())&&(l=f.verb,delete f.verb,l=this.cue(this.VERB[l.toString().toUpperCase()],"",{exarg:f}));
return l};this.change_config=function(){ADL.XAPIWrapper.changeConfig({endpoint:this.endpoint,user:this.user,password:this.password,name:this.student.named});return this.ERROR.NOERROR};this.send_statement=function(f){if(!this.initialized)return this.log("ERROR: Sending requires a locker!"),this.ERROR.NO_LOCKER_FOUND;try{ADL.XAPIWrapper.sendStatement(f,function(){Lumi.log("Statement posted.")})}catch(l){this.log("No statement sent; network connectivity???")}};this.breadcrumb=function(f){this.last_registered_breadcrumb=
void 0!==f&&null!==f&&f.length?encodeURIComponent(f):this.hash(this.course_uri)};this.hash=function(f){return ADL.XAPIWrapper.hash(f)};this.log=function(f){this.logging_enabled&&console.log("LumiJS::"+f)};this.ERROR={NOERROR:0,INIT_REQUIRED:1,BAD_PARAM_FORMAT:2,INVALID_PARAM:4,NOERROR_DEPRECATED:0,NO_LOCKER_FOUND:16};this.VERB={LAUNCHED:{id:"http://learningconsole.com/verbs/launched",display:{"en-US":"launched"}}};this.initialized=!1;this.password=this.user=this.endpoint=null;this.student={named:null,
inbox:null};this.course_uri=this.course_id_uuid="";this.actor=null;this.locker_store="http://privacysphere.com/api/lrslink/";this.logging_enabled=!1},Lumi=new LumiX;
